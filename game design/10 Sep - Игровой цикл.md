### игровой цикл - основы взаимодействия игрока и игры
игровой цикл - центральный процесс игры непрерывно выполняющийся с момента запуска до завершения

Основные задачи:
- принять входные данные (input)
- обновить состояние игры на основе данных (update)
- отобразить результат на экране (render)
- процесс повторяется десятки\сотни раз в секунду

$$
input -> update -> render -> input
$$
## шаги цикла

### 1) Ввод

Цикл начинается со сбора пользовательского ввода источники: клавиатура геймпад мышь тачпад тачскрин микрофон

Задача - зафиксировать намеренье игрока и преобразовать его в данные для игры

### 2) Обновления
(топ 1 по затратности производительности)
На основе полученного ввода и внутренних правил игра вычисляет новое состояние
что происходит:

- Движение персонажей и объектов
- Проверка столкновений
- ИИ противников
- Обработка физики(гравитация, трение)
- Обновления таймеров состояний (здоровье, мана) и логики игры

### 3) Рендер
(топ 2 по затратности производительности)
Финальный этап - отображение обновленного состояния игры на экране

*Задача* - преобразовать сухие данные (координаты, состояния) в красочную картинку
*Что включает* - отрисовка 2D\3D графики освещение тени частицы эффекты постобработки интерфейс

*важно что игрок видит только результат рендеринга, а не процесс симуляции* 

## Игровой цикл как единое целое

Так как цикл повторяется (input -> update -> render -> input)
то на каждый этап уходит определённое количество миллисекунд -> если времени на обработку не хватит fps уменьшится и будут лаги

## Связь fps и плавности геймплея

Чем выше fps тем 
- отзывчивей управление
- плавнее изображение
- приятнее игровой опыт

Следовательно низкий fps ведет к : дрожанию, пропускам кадров и высоким инпут лагом

*стабильный fps важнее высокого и не стабильного*

## Два подхода к синхронизации

| ***Fixed update - фиксированное обновление***      | ***variable time speed - переменный шаг***               |
| -------------------------------------------------- | -------------------------------------------------------- |
| update вызывается с строго одинаковыми интервалами | update вызывается так часто как может компьютер          |
| Плюсы : стабильная предсказуемая физика и логика   | Плюсы: Эффективно                                        |
| Минусы: бывает не эффективно                       | Минусы - физика бывает не стабильной на разных мощностях |

## Игровой цикл в разных жанрах 


| **Жанр**       | **FPS**                                            | **RTS**                                     | **TBS**                                                        | **Казуальные / Мобильные**               |
| -------------- | -------------------------------------------------- | ------------------------------------------- | -------------------------------------------------------------- | ---------------------------------------- |
| **приоритеты** | Максимально низкая задержка ввода и быстрый рендер | сложный update (ии сотен юнитов, экономика) | нет непрерывной симуляции                                      | энергоэффективность                      |
| **Цикл**       | простой update                                     | input и render менее критичны к скорости    | Цикл: ожидание input ->обработка хода -> рендер ->ожидание ... | Цикл может засыпать для экономии энергии |


## Проблема и Оптимизация цикла

Бутылочное горлышко - один этап цикла замедляет другие
CPU(логика) и GPU(рендер)

Пропуск кадров - случается если цикл не уложился в отведенное время

Задержка ввода - большое время между действием и реакцией


> [!NOTE] Советы
> Всегда учитывать производительность
> Тесно сотрудничать с командой. Спрашивать как дорого это будет стоить
> Прототипируй и тестируй
> Тестируй на разном железе
> инпут лаг - говно

