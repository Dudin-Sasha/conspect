### игровой цикл - основы взаимодействия игрока и игры
игровой цикл - центральный процесс игры непрерывно выполняющийся с момента запуска до завершения

Основные задачи:
- принять входные данные (input)
- обновить состояние игры на основе данных (update)
- отобразить результат на экране (render)
- процесс повторяется десятки\сотни раз в секунду

$$
input -> update -> render -> input
$$
## шаги цикла

### 1) Ввод

Цикл начинается со сбора пользовательского ввода источники: клавиатура геймпад мышь тачпад тачскрин микрофон

Задача - зафиксировать намеренье игрока и преобразовать его в данные для игры

### 2) Обновления
(топ 1 по затратности производительности)
На основе полученного ввода и внутренних правил игра вычисляет новое состояние
что происходит:

- Движение персонажей и объектов
- Проверка столкновений
- ИИ противников
- Обработка физики(гравитация, трение)
- Обновления таймеров состояний (здоровье, мана) и логики игры

### 3) Рендер
(топ 2 по затратности производительности)
Финальный этап - отображение обновленного состояния игры на экране

*Задача* - преобразовать сухие данные (координаты, состояния) в красочную картинку
*Что включает* - отрисовка 2D\3D графики освещение тени частицы эффекты постобработки интерфейс

*важно что игрок видит только результат рендеринга, а не процесс симуляции* 

## Игровой цикл как единое целое

Так как цикл повторяется (input -> update -> render -> input)
то на каждый этап уходит определённое количество миллисекунд -> если времени на обработку не хватит fps уменьшится и будут лаги

## Связь fps и плавности геймплея

Чем выше fps тем 
- отзывчивей управление
- плавнее изображение
- приятнее игровой опыт

Следовательно низкий fps ведет к : дрожанию, пропускам кадров и высоким инпут лагом

*стабильный fps важнее высокого и не стабильного*

## Два подхода к синхронизации

| ***Fixed update - фиксированное обновление***      | ***variable time speed - переменный шаг***               |
| -------------------------------------------------- | -------------------------------------------------------- |
| update вызывается с строго одинаковыми интервалами | update вызывается так часто как может компьютер          |
| Плюсы : стабильная предсказуемая физика и логика   | Плюсы: Эффективно                                        |
| Минусы: бывает не эффективно                       | Минусы - физика бывает не стабильной на разных мощностях |

## Игровой цикл в разных жанрах 


| **Жанр**       | **FPS**                                            | **RTS**                                     | **TBS**                                                        | **Казуальные / Мобильные**               |
| -------------- | -------------------------------------------------- | ------------------------------------------- | -------------------------------------------------------------- | ---------------------------------------- |
| **приоритеты** | Максимально низкая задержка ввода и быстрый рендер | сложный update (ии сотен юнитов, экономика) | нет непрерывной симуляции                                      | энергоэффективность                      |
| **Цикл**       | простой update                                     | input и render менее критичны к скорости    | Цикл: ожидание input ->обработка хода -> рендер ->ожидание ... | Цикл может засыпать для экономии энергии |


## Проблема и Оптимизация цикла

Бутылочное горлышко - один этап цикла замедляет другие
CPU(логика) и GPU(рендер)

Пропуск кадров - случается если цикл не уложился в отведенное время

Задержка ввода - большое время между действием и реакцией


> [!NOTE] Советы
> Всегда учитывать производительность
> Тесно сотрудничать с командой. Спрашивать как дорого это будет стоить
> Прототипируй и тестируй
> Тестируй на разном железе
> инпут лаг - говно



core loop геймплейное ядро, к которому присоединяются все игровые механики

именно core loop определяет игру, ведь это небольшой набор ключевых механик, которые являются самыми важными для игры `например: шутер без стрельбы`


==Новый цикл== -> ==понимание принципов работы цикла== -> ==усваивание цикла== -> ==формирование привычки== ->==рутина==

1. Своевременность
	- циклы должны добавляться и изменяться вовремя их задача удерживать интерес к игре
2. Гармоничность
	- изменения не должны нарушать логику геймплея 
3. Разнообразие
	- не заваливать игрока и программиста новыми механиками, а предоставить разносторонность геймплея

![[Pasted image 20250917171756.png]]


### Пространство игровых состояний

1)  Восприятие доступной информации о текущем игровом состоянии
2) Интерпретация этой информации и форматирование в сознании некого "слепка" из важных игровых аспектов игрового состояния
3) сложность пространства (слишком сложная игра приводит к реакции "да и пофиг")
4) Простота пространства (слишком легкая игра скучная)
5) Требования к навыку оценки игрового состояния. Чем они выше тем хардкорней будет игра, а хардкор отпугивает аудиторию
6) Подача важной информации об игровом состоянии
### Цель
 Цель игрока в рамках игрового цикла - перевести игровое состояние из одной точки в пространстве состояний в другую приближающую его к успеху или победе


|           | МикроУровень                    | МакроУровень                     |
| --------- | ------------------------------- | -------------------------------- |
| Цель:     | попасть в компонент машины      | прокачать лук                    |
| Действие: | подвинуть мышкой и кликнуть ЛКМ | выбить с машины нужный компонент |

### Набор действий

В конкретном игровом цикле действия - это вообще все опции, которые есть у игрока на данный момент 

Ценность действий зависит от разных факторов:
1) Текущее игровое состояние
2) Навык игрока к оценке игрового состояния
3) Общие знания игрока об игре

Важно усложнить путь к пониманию ценности
1) Ввести в игру случайность
2) Добавить в игру другого игрока
3) Скрыть часть информации от игрока
4) Сделать расчет истинной ценность очень сложной

Дизайн набора действий:
1) Слишком мало действий
2) Слишком много действий
3) Ценность действия одинакова на всем пространстве
4) Ценность действия слишком локализована в небольшой области
5) Действие доминирует по ценности надо другими на всем пространстве игровых состояний
6) Истинная ценность каждого действия слишком легко просчитывается на всем пространстве игровых состояний
7) Плохое донесение игры до игрока (аааа тут хойка как пример)


### Решение (выбор стратегии)

- Ощущаемая ценность обоих действий около нулевая (плохой вариант)
- Ощущаемая ценность действия А явно выше ценности действия Б (плохой вариант)
- Ощущаемая ценность обоих действий равна (плохой вариант)
- Ощущаемая ценность А выше, но в другой равновероятной ситуации действие Б ценнее (хороший вариант)
- Ощущаемая ценность действия А не очевидно выше ценности действия Б (хороший вариант)


Когнитивная нагрузка - столько усилий должен приложить игрок чтобы принять решение. Она складывается из объема необходимой информации, удобства доступа к этой информации и сложности её анализа.

Ощущаемая значимость - насколько важным по мнению игрока является решение для достижения цели

### Интересное решение = 
=  ↑Когнитивная нагрузка + ↑Ощущаемая значимость

#### Ошибки
- Задизайнить плохой набор действий (бессмысленные действия для продвижения)
- Сделать явное несоответствие между когнитивной нагрузкой и ощущаемой значимостью
- Слишком часто мучать игрока высокой когнитивной нагрузкой
- Спрятать весь интерес решений за слишком крутой кривой научения

## Реализация

Низкоуровневый кор-геймплей 
Высокая требовательность к реализации повышает скилл-кап и скилл-гэп

#### Ошибки реализации
- Несоответствие сложности принятия решения и сложности его реализации
- Несоответствие сложности реализации и потребностей аудитории
### Обратная связь

На этом этапе игра предоставляет игроку обратную связь визуализируя результат действия игрока и переход игрового состояния в другую точку пространства игровых состояний
#### Каналы восприятия:

1) Визуальный 
2) Аудиальный
3) Тактильный
Основное требование к организации этих каналов обратной связи - читаемость
Игровые события нужно распределять по значимости


#### Ошибки при обратной связи
- Давать слишком мало фидбека
- Давать слишком много фидбека
- Не использовать какой-либо канал связи
- Не выстраивать иерархию важности игровых событий на которые дается фидбек

## Нарратив
